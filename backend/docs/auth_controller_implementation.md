# 認証コントローラーの実装ドキュメント

## 概要
このドキュメントでは、予約システムの認証機能を担当する`AuthController`の実装について説明します。認証コントローラーは、ユーザー登録（サインアップ）とログイン機能を提供し、JWT（JSON Web Token）を使用した認証システムを実装しています。

## 実装内容

### AuthController
`AuthController`は以下の2つの主要なエンドポイントを提供します：

1. **サインアップ（ユーザー登録）**: `/api/auth/signup`
   - 新規ユーザーを登録するためのエンドポイント
   - ユーザー名とメールアドレスの重複チェックを行う
   - パスワードはハッシュ化して保存

2. **ログイン**: `/api/auth/login`
   - 既存ユーザーの認証を行うエンドポイント
   - 認証成功時にJWTトークンを発行
   - ユーザー情報と共にトークンを返却

### 修正点

実装にあたり、以下の問題点を修正しました：

1. **サインアップエンドポイントの完成**
   - ユーザー登録処理の実装
   - `UserRegistrationDTO`への変換処理の追加
   - 適切なレスポンス返却の実装

2. **ログインエンドポイントの追加**
   - ユーザー認証処理の実装
   - JWTトークン生成処理の追加
   - 認証エラー処理の実装

3. **認証関連クラスの修正**
   - `AuthDTO.TokenResponse`クラスのコンストラクタ修正
   - `SecurityConfig`クラスに`AuthenticationManager`ビーンの追加
   - JWTフィルターの設定追加

## 認証フロー

1. **サインアップ処理**:
   - クライアントから送信されたユーザー情報（ユーザー名、メール、パスワード）を受け取る
   - ユーザー名とメールアドレスの重複チェック
   - パスワードをハッシュ化
   - ユーザー情報をデータベースに保存
   - 登録完了メッセージを返却

2. **ログイン処理**:
   - クライアントから送信された認証情報（ユーザー名、パスワード）を受け取る
   - `AuthenticationManager`を使用してユーザーを認証
   - 認証成功時、JWTトークンを生成
   - トークンとユーザー情報をレスポンスとして返却

3. **認証後のリクエスト処理**:
   - クライアントはリクエストヘッダーにJWTトークンを含めて送信
   - `JwtRequestFilter`がトークンを検証
   - 有効なトークンの場合、`SecurityContext`に認証情報を設定
   - 保護されたリソースへのアクセスを許可

## セキュリティ設定

`SecurityConfig`クラスでは以下の設定を行っています：

- CORS（Cross-Origin Resource Sharing）の設定
- CSRF保護の無効化（RESTful APIのため）
- エンドポイントごとのアクセス制御
- ステートレスなセッション管理（JWT認証のため）
- JWTフィルターの追加

## 使用技術

- Spring Security: 認証・認可フレームワーク
- JWT: トークンベースの認証
- BCrypt: パスワードハッシュ化アルゴリズム
- Lombok: ボイラープレートコード削減ライブラリ

## まとめ

認証コントローラーの実装により、セキュアなユーザー登録とログイン機能が提供されます。JWTを使用したトークンベースの認証により、ステートレスでスケーラブルな認証システムが実現されています。